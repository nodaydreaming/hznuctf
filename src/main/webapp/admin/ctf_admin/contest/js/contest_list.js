/*var contest_list = [{"competitionId" : "1.1",
                     "competitionTitle" : "杭州师范大学第一届CTF竞赛模拟赛",
                     "start" : "2017.2.8",
                     "end" : "2017.2.10",
                     "createtime" : "2017.2.1",
                     "competitionNumber" : "1",
                     "canregister" : 1,
                     "isteam" : 1 ,
                     "publisher" : "骆闻舟",
                     "holder" : "费渡费渡费渡费渡费渡费渡费渡费渡费渡费渡",
                      "intro" : "aaaaaaaaaaaaaaaa",
                      "target" : "bbbbbbbbbbbb",
                      "plan" : "cccccccccc",
                      "rule" : "ddddddddd",
                      "reward" : "eeeeeeeeeeeeeeee",
                      "registration" : "ffffffffffff",
                      "image" : "1"
                      },
                     {"competitionId" : "2.2",
                     "competitionTitle" : "杭州师范大学第二届CTF竞赛模拟赛",
                     "start" : "2017.3.8",
                     "end" : "2017.3.10",
                     "createtime" : "2017.3.1",
                     "competitionNumber" : "2",
                     "canregister" : 0,
                     "isteam" : 0 ,
                     "publisher" : "骆",
                     "holder" : "费渡费渡费渡费渡费渡费渡费渡费渡费渡费渡费渡费渡费渡费渡费渡费渡费渡费渡费渡费渡费渡",
                     "intro" : "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa",
                      "target" : "bbbbbbbbbbbbbbbbbbbbbbbbbbbbbb",
                      "plan" :"cccccccccccccccccccccccccc",
                      "rule" : "ddddddddddddddddddddddddddddd",
                      "reward" : "eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee",
                      "registration" : "fffffffffffffffffffffffffffffff",
                      "image" : "1"},
                      {"competitionId" : "3.3",
                     "competitionTitle" : "杭州师范大学第二届CTF竞赛模拟赛",
                     "start" : "2017.3.8",
                     "end" : "2017.3.10",
                     "createtime" : "2017.3.1",
                     "competitionNumber" : "2",
                     "canregister" : 0,
                     "isteam" : 0 ,
                     "publisher" : "骆闻",
                     "holder" : "费渡费渡费渡费渡费渡费渡费渡费渡费渡费渡费渡费渡费渡费渡费渡费渡费渡费渡费渡费渡费渡",
                     "intro" : "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa",
                      "target" : "bbbbbbbbbbbbbbbbbbbbbbbbbbbbbb",
                      "plan" :"cccccccccccccccccccccccccc",
                      "rule" : "ddddddddddddddddddddddddddddd",
                      "reward" : "eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee",
                      "registration" : "fffffffffffffffffffffffffffffff",
                      "image" : "1"}];

var allcontest_list=[{"competitionId" : "1.1",
                     "competitionTitle" : "杭州师范大学第一届CTF竞赛模拟赛",
                     "start" : "2017.2.8",
                     "end" : "2017.2.10",
                     "createtime" : "2017.2.1",
                     "competitionNumber" : "1",
                     "canregister" : 1,
                     "isteam" : 1 ,
                     "publisher" : "骆闻舟",
                     "holder" : "费渡费渡费渡费渡费渡费渡费渡费渡费渡费渡",
                      "intro" : "aaaaaaaaaaaaaaaa",
                      "target" : "bbbbbbbbbbbb",
                      "plan" : "cccccccccc",
                      "rule" : "ddddddddd",
                      "reward" : "eeeeeeeeeeeeeeee",
                      "registration" : "ffffffffffff",
                      "image" : "1"
                      },
                     {"competitionId" : "2.2",
                     "competitionTitle" : "杭州师范大学第二届CTF竞赛模拟赛",
                     "start" : "2017.3.8",
                     "end" : "2017.3.10",
                     "createtime" : "2017.3.1",
                     "competitionNumber" : "2",
                     "canregister" : 0,
                     "isteam" : 0 ,
                     "publisher" : "骆",
                     "holder" : "费渡费渡费渡费渡费渡费渡费渡费渡费渡费渡费渡费渡费渡费渡费渡费渡费渡费渡费渡费渡费渡",
                     "intro" : "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa",
                      "target" : "bbbbbbbbbbbbbbbbbbbbbbbbbbbbbb",
                      "plan" :"cccccccccccccccccccccccccc",
                      "rule" : "ddddddddddddddddddddddddddddd",
                      "reward" : "eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee",
                      "registration" : "fffffffffffffffffffffffffffffff",
                      "image" : "1"},
                      {"competitionId" : "3.3",
                     "competitionTitle" : "杭州师范大学第二届CTF竞赛模拟赛",
                     "start" : "2017.3.8",
                     "end" : "2017.3.10",
                     "createtime" : "2017.3.1",
                     "competitionNumber" : "2",
                     "canregister" : 0,
                     "isteam" : 0 ,
                     "publisher" : "骆闻",
                     "holder" : "费渡费渡费渡费渡费渡费渡费渡费渡费渡费渡费渡费渡费渡费渡费渡费渡费渡费渡费渡费渡费渡",
                     "intro" : "aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa",
                      "target" : "bbbbbbbbbbbbbbbbbbbbbbbbbbbbbb",
                      "plan" :"cccccccccccccccccccccccccc",
                      "rule" : "ddddddddddddddddddddddddddddd",
                      "reward" : "eeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeeee",
                      "registration" : "fffffffffffffffffffffffffffffff",
                      "image" : "1"}];

var loginAdmin = {"adminState" : 1,
                  "adminName" : "骆闻舟"}
*/
var contest_list, allcontest_list, contest;//比赛列表
var original_choiceType, original_choiceRegister,photo;
var contest_title, contest_starttime, contest_endtime, contest_number, contest_holder , contest_intro ,contest_target ,contest_plan ,contest_rule ,contest_reward,contest_registration ,contest_type, contest_register;
var teamcompetitor_list;

window.onload = function () {
    // 此ajax不适用于main.html页面获取管理员信息
    $.ajax({
        url: '../../../admin/getAdminMap',  //获取管理员个人信息
        type: 'post',
        scriptCharset: 'utf-8',
        success: function (result) {
            var loginAdmin = result.loginAdmin;
            //设置登陆用户的昵称
            if (loginAdmin.adminNickname != null) {
                ($('.layui-nav-img')[0].parentNode).childNodes[2].data =loginAdmin.adminNickname;
            }
            //设置登陆用户的头像
            if (loginAdmin.adminImage != null) {
                $('.layui-nav-img').attr("src", loginAdmin.adminImage);
            }
            //判断是否是教师
            if (loginAdmin.adminState == 2) {
                var realname = loginAdmin.adminName;
                getselfContests(realname);
            }
            else if(loginAdmin.adminState == 1 || loginAdmin.adminState == 0){
                getContests();
            }
        },
        error: function () {
            layer.msg("请求失败！");
        }
    });
};
//填充教师的赛事列表的表格
function getselfContests(realname){
    $.ajax({
        url : '../../../competition/listCompetition',
        type : 'post',
        scriptCharset : 'utf-8',
        success : function (result) {
            if(result.status =="success"){
                allcontest_list = result.competitionList;
                var contest_list = new Array();
                for(var i = 0; i < allcontest_list.length; ++i){
                    contest = allcontest_list[i];
                    if (contest.publisher == realname){
                        contest_list.push(contest)
                    }
                }
                fillContests(contest_list);
            }

            else{
                layer.msg(result.message);
            }
        },
        error : function () {
            layer.msg("请求赛事列表失败！");
        }
    });
}

//填充赛事列表的表格
function getContests() {
    $.ajax({
        url : '../../../competition/listCompetition',
        type : 'post',
        scriptCharset : 'utf-8',
        success : function (result) {
            if(result.status =="success"){
                contest_list = result.competitionList;
                fillContests(contest_list);
            }
            else{
                layer.msg(result.message);
            }
        },
        error : function () {
            layer.msg("请求赛事列表失败！");
        }
    });
}


function fillContests(contest_list){
    var tbody = document.getElementsByTagName('tbody')[0];
    $('tbody').html("");

    for(var i = 0; i < contest_list.length; ++i){
        var contest0 = contest_list[i];
        var tr = document.createElement('tr');
        var type1 = "";
        var type2 = "";
        if(contest0.canregister == 1){
            type1="能";
        }
        else{
            type1="不能";
        }
        if(contest0.isteam == 1){
            type2="团体赛";
        }
        else{
            type2="个人赛";
        }
        //序号
        var td1 = document.createElement('td');
        td1.style.textAlign = "center";
        td1.innerText = i+1;
        tr.appendChild(td1);

        //赛事名称
        var td2 = document.createElement('td');
        td2.style.textAlign = "center";
        td2.innerText = contest0.competitionTitle;
        td2.style.wordWrap = "break-word";
        tr.appendChild(td2);

        //开始时间
        var td3 = document.createElement('td');
        td3.style.textAlign = "center";
        td3.innerText = contest0.start;
        td3.style.wordWrap = "break-word";
        tr.appendChild(td3);

        //结束时间
        var td4 = document.createElement('td');
        td4.style.textAlign = "center";
        td4.innerText =contest0.end;
        td4.style.wordWrap = "break-word";
        tr.appendChild(td4);

        //创建时间按
        var td5 = document.createElement('td');
        td5.style.textAlign = "center";
        td5.innerText =contest0.createtime;
        td5.style.wordWrap = "break-word";
        tr.appendChild(td5);

        //能否参赛
        var td6 = document.createElement('td');
        td6.style.textAlign = "center";
        td6.innerText = type1;
        td6.style.wordWrap = "break-word";
        tr.appendChild(td6);

        //是否团体赛
        var td7 = document.createElement('td');
        td7.style.textAlign = "center";
        td7.innerText = type2;
        td7.style.wordWrap = "break-word";
        tr.appendChild(td7);

        //编号
        var td8 = document.createElement('td');
        td8.style.textAlign = "center";
        td8.innerText = contest0.competitionNumber;
        td8.style.wordWrap = "break-word";
        tr.appendChild(td8);

        //发布者
        var td10 = document.createElement('td');
        td10.style.textAlign = "center";
        td10.innerText = contest0.publisher;
        td10.style.wordWrap = "break-word";
        tr.appendChild(td10);

        var td11 = document.createElement('td');

        //编辑
        var a1 = document.createElement('a');
        a1.className = "layui-btn layui-btn-normal layui-btn-xs";
        var i1 = document.createElement('i');
        i1.className = "layui-icon layui-icon-edit";
        a1.appendChild(i1);
        a1.onclick = edit_contest;
        td11.appendChild(a1);

        //删除
        var a2 = document.createElement('a');
        a2.className = "layui-btn layui-btn-danger layui-btn-xs";
        var i2 = document.createElement('i');
        i2.className = "layui-icon layui-icon-delete";
        a2.appendChild(i2);
        a2.onclick = del_contest;
        td7.style.textAlign = "center";
        td11.appendChild(a2);

        //选手管理
        var a3 = document.createElement('a');
        a3.className = "layui-btn layui-btn layui-btn-normal layui-btn-xs";
        var i3 = document.createElement('i');
        i3.className = "layui-icon layui-icon-friends";
        a3.appendChild(i3);
        a3.href='teamcompetitor.html?id='+ contest_list[i].competitionId+'';
        td11.appendChild(a3);

        //通知
        var a5 = document.createElement('a');
        a5.className = "layui-btn layui-btn layui-btn layui-btn-xs";
        var i5 = document.createElement('i');
        i5.className = "layui-icon layui-icon-notice";
        a5.appendChild(i5);
        a5.href='tips_list.html?id='+ contest_list[i].competitionId+'';
        td11.appendChild(a5);

        //赛题
        var a4 = document.createElement('a');
        a4.className = "layui-btn layui-btn-normal layui-btn-xs";
        var i4 = document.createElement('i');
        i4.className = "layui-icon layui-icon-form";
        a4.appendChild(i4);
        a4.innerHTML = a4.innerHTML + "赛题";
        a4.href='competitionquestion_list.html?id='+ contest_list[i].competitionId+'';
        td11.appendChild(a4);

        //队伍
        var a6 = document.createElement('a');
        a6.className = "layui-btn layui-btn layui-btn-xs";
        var i6 = document.createElement('i');
        i6.className = "layui-icon layui-icon-group";
        a6.appendChild(i6);
        a6.innerHTML = a6.innerHTML + "队伍";
        a6.href='team_list.html?id='+ contest_list[i].competitionId+'';
        td11.appendChild(a6);

        tr.appendChild(td11);

        tbody.appendChild(tr);
    }
}


//修改比赛基本信息
function edit_contest(){
    var tr = this.parentNode.parentNode;
    var num = tr.childNodes[0].innerText;
    var competition = contest_list[num-1];

    original_choiceType = competition.isteam;
    original_choiceRegister = competition.canregister;
    photo = (competition.image == null) ? "" : (competition.image);

    layer.open({
        type: 1,
        offset: 'auto',
        skin: 'layui-layer-lan',
        id: 'layerDemo1', //防止重复弹出
        area: ['900px', '700px'],
        content:'<form class="layui-form" action="" id="updateContest" style="margin:50px 0 0 5%; font-size:15px">\n' +
            //比赛名称
            '<div class="layui-form-item" style="width:100%">\n' +
            '    <label class="layui-form-label">比赛名称</label>\n' +
            '    <div class="layui-input-block">\n' +
            '    <input type="text" id="contest_title" autocomplete="off" placeholder="请输入比赛名称" required class="layui-input layui-disabled" disabled style="width: 80%;" value="'+ competition.competitionTitle +'" onchange="inputLimit()" onkeydown="inputLimit()" onkeyup="inputLimit()">\n' +
            '    </div>\n' +
            '</div>\n' +

            //开始时间
            '<div class="layui-form-item">\n' +
            '    <label class="layui-form-label">开始时间</label>\n' +
            '    <div class="layui-input-block">\n' +
            '        <input type="text" id="contest_starttime" autocomplete="off" placeholder="yyyy-MM-dd HH:mm:ss" class="layui-input" style="width:200px" \n' +
            '        onkeypress="inputLimit()" value="'+new Date(competition.start).Format("yyyy-MM-dd hh:mm:ss")+'">\n' +
            '    </div>\n' +
            '</div>\n' +

            //结束时间
            '<div class="layui-form-item">\n' +
            '    <label class="layui-form-label">结束时间</label>\n' +
            '    <div class="layui-input-block">\n' +
            '        <input type="text" id="contest_endtime" autocomplete="off" placeholder="yyyy-MM-dd HH:mm:ss" class="layui-input" style="width:200px" \n' +
            '        onkeypress="inputLimit()" value="'+new Date(competition.end).Format("yyyy-MM-dd hh:mm:ss")+'">\n' +
            '    </div>\n' +
            '</div>\n' +

            //比赛类型
            '<div class="layui-form-item" id="contest_type">\n' +
            '    <label class="layui-form-label">比赛类型</label>\n' +
            '    <input name="contest_type" title="团队赛" type="radio" value="1" id="11">\n' +
            '    <div class="layui-unselect layui-form-radio layui-form-radiod">\n' +
            '        <i class="layui-anim layui-icon"></i>\n' +
            '        <div>团队赛</div>\n' +
            '    </div>\n' +
            '    <input name="contest_type" title="个人赛" type="radio" value="0" id="10">\n' +
            '    <div class="layui-unselect layui-form-radio">\n' +
            '        <i class="layui-anim layui-icon"></i>\n' +
            '        <div>个人赛</div>\n' +
            '    </div>\n' +
            '</div> \n' +

            //能否参赛
            '<div class="layui-form-item" id="contest_register">\n' +
            '    <label class="layui-form-label">能否参赛</label>\n' +
            '    <input name="contest_canregister" title="能" type="radio" value="1" id="21">\n' +
            '    <div class="layui-unselect layui-form-radio layui-form-radiod">\n' +
            '        <i class="layui-anim layui-icon"></i>\n' +
            '        <div>能</div>\n' +
            '    </div>\n' +
            '    <input name="contest_canregister" title="不能" type="radio" value="0" id="20">\n' +
            '    <div class="layui-unselect layui-form-radio">\n' +
            '        <i class="layui-anim layui-icon"></i>\n' +
            '        <div>不能</div>\n' +
            '    </div>\n' +
            '</div> \n' +

            //比赛编号
            '<div class="layui-form-item">\n' +
            '    <label class="layui-form-label">比赛编号</label>\n' +
            '    <div class="layui-input-block">\n' +
            '    <input type="text" id="contest_number" autocomplete="off" placeholder="请输入比赛编号" required class="layui-input " style="width: 80%;"value="'+ competition.competitionNumber +'" onchange="inputLimit()" onkeydown="inputLimit()" onkeyup="inputLimit()">\n' +
            '    </div>\n' +
            '</div>\n' +

            //主办方
            '<div class="layui-form-item">\n' +
            '    <label class="layui-form-label">主办方</label>\n' +
            '    <div class="layui-input-block">\n' +
            '     <textarea name="desc" id="contest_holder" placeholder="请输入主办方" class="layui-textarea" style="width: 80%;">'+ competition.holder +'</textarea>\n' +
            '    </div>\n' +
            '</div>\n' +

            '<div class="layui-form-item layui-form-text">\n' +
            '     <label class="layui-form-label">介绍</label>\n' +
            '     <div class="layui-input-block">\n' +
            '     <textarea name="desc" id="contest_intro" placeholder="请输入比赛介绍" class="layui-textarea" style="width: 80%;">'+ competition.intro +'</textarea>\n' +
            '     </div>\n' +
            '</div>\n' +

            '        <div class="layui-form-item layui-form-text">\n' +
            '            <label class="layui-form-label">对象及形式</label>\n' +
            '            <div class="layui-input-block">\n' +
            '              <textarea name="desc" id="contest_target" placeholder="请输入比赛对象及形式" class="layui-textarea" style="width: 80%;">'+ competition.target +'</textarea>\n' +
            '            </div>\n' +
            '        </div>\n' +

            '        <div class="layui-form-item layui-form-text">\n' +
            '            <label class="layui-form-label">赛事安排及内容</label>\n' +
            '            <div class="layui-input-block">\n' +
            '             <textarea name="desc" id="contest_plan" placeholder="请输入赛事安排及内容" class="layui-textarea" style="width: 80%;">'+ competition.plan +'</textarea>\n' +
            '           </div>\n' +
            '        </div>\n' +

            '        <div class="layui-form-item layui-form-text">\n' +
            '            <label class="layui-form-label">规则</label>\n' +
            '            <div class="layui-input-block">\n' +
            '              <textarea name="desc" id="contest_rule" placeholder="请输入比赛规则" class="layui-textarea" style="width: 80%;" >'+ competition.rule +'</textarea>\n' +
            '            </div>\n' +
            '        </div>\n' +

            '        <div class="layui-form-item layui-form-text">\n' +
            '           <label class="layui-form-label">奖励</label>\n' +
            '            <div class="layui-input-block">\n' +
            '              <textarea name="desc" id="contest_reward" placeholder="请输入比赛奖励" class="layui-textarea" style="width: 80%;">'+ competition.reward +'</textarea>\n' +
            '           </div>\n' +
            '        </div>\n' +

            '        <div class="layui-form-item layui-form-text">\n' +
            '            <label class="layui-form-label">报名方式</label>\n' +
            '            <div class="layui-input-block">\n' +
            '              <textarea name="desc" id="contest_registration" placeholder="请输入报名方式" class="layui-textarea" style="width: 80%;">'+ competition.registration +'</textarea>\n' +
            '            </div>\n' +
            '        </div>\n' +

            '        <div class="layui-form-item layui-upload">\n' +
            '            <label class="layui-form-label">图&nbsp;&nbsp;&nbsp;片</label>\n' +
            '            <div class="layui-upload-list">\n' +
            '                <img class="layui-upload-img" id="demo1" style="float:left;" src="'+ photo +'">\n' +
            '                <div style="float:left;">\n' +
            '                    <button type="button" class="layui-btn" id="upload">上传图片</button>\n' +
            '                    <p id="demoText" style="width: 100px; margin-top: 20px"></p>\n' +
            '                </div>\n' +
            '           </div>\n' +
            '           <label class="layui-form-label" style="width: 200px;">只能上传一张，最好是海报</label>\n' +
            '        </div>\n' +

            '</form>' ,

        btn: ['确定', '取消'],
        btnAlign: 'c',
        shade: 0.5,
        title: "更新比赛基本信息",
        btn1 : function () {
            check_contest(competition, photo);
            return false;
        },
        btn2 : function () {
            layer.closeAll();
        }
    });
    layui.use('upload', function() {
        var $ = layui.jquery, upload = layui.upload;  //得到 upload 对象
        //普通图片上传使用layui上传图片
        //创建一个上传组件
        uploadInst = upload.render({
            elem: '#upload'  //绑定元素(上传图片的按钮)
            , url: '../../../file/uploadCompetitionImage'
            , accept : 'images'   //指定允许上传时校验的文件类型
            , multiple : false
            , auto : false     //选择文件后不自动上传
            , field : 'file'
            , choose: function (obj) {     //choose：选择文件后的回调函数，在文件被选择后触发
                //预读本地文件示例，不支持ie8 +
                obj.preview(function (index, file, result) {
                    //console.log(index); //得到文件索引
                    //console.log(file); //得到文件对象
                    //console.log(result); //得到文件base64编码，比如图片
                    $('.layui-upload').css("height", "10%");
                    $('.layui-upload').css("height", "10%");
                    $('.layui-upload').css("marginButtom", "10px");
                    $('#demo1').attr('src', result);  //图片链接（base64）\n' +
                    $('#demo1').css("maxWidth", "10%");
                    $('#demo1').css("marginRight", "10px");
                    photo = result;
                });
            }
            , done: function (res) {  //执行上传请求后的回调
                //如果上传失败
                if (res.status == "error") {
                    return layer.msg('上传失败');
                }
                //上传成功
                else
                {
                    photo = res.src;
                    $('#demo1').attr('src', photo);
                    updateContest(competition.competitionId, photo, contest_title, contest_starttime, contest_endtime, contest_number, contest_holder , contest_intro ,contest_target ,contest_plan ,contest_rule ,contest_reward,contest_registration ,contest_type, contest_register);
                }
            }
            , error: function () {
                //演示失败状态，并实现重传
                var demoText = $('#demoText');
                demoText.html('<span style="color: #FF5722;">上传失败</span> <a class="layui-btn layui-btn-xs demo-reload">重试</a>');
                demoText.find('.demo-reload').on('click', function () {
                    uploadInst.upload();
                });
            }
        });
    });

    layui.use('form', function(){
        var form = layui.form;
        fillcanregisterSelect();
        fillisteamSelect();
        form.render();
        form.verify();
    });

    layui.use('laydate', function(){
        var laydate = layui.laydate;
        laydate.render({
            elem : "#contest_starttime"
            ,type: 'datetime'
        });
    });

    layui.use('laydate', function(){
        var laydate = layui.laydate;
        laydate.render({
            elem : "#contest_endtime"
            ,type: 'datetime'
        });
    });

    layui.use('element', function(){
        var element = layui.element;   //导航的hover效果、二级菜单等功能，需要依赖element模块\n' +
        //监听导航点击\n' +
        element.on('nav(demo)', function(elem){
            //console.log(elem)
            layer.msg(elem.text());
        });
    });
}

function fillcanregisterSelect(){
    for (var i = 0; i < contest_list.length; ++i){
        if (original_choiceRegister == 1){
            $("#21").attr("checked","checked");
        }
        else if(original_choiceRegister == 0){
            $("#20").attr("checked","checked");
        }
    }
}

function fillisteamSelect(){
    for (var i = 0; i < contest_list.length; ++i){
        if (original_choiceType == 1){
            $("#11").attr("checked","checked");
        }
        else if(original_choiceType == 0){
            $("#10").attr("checked","checked");
        }
    }
}

//检查输入
function check_contest(competition,photo) {
    contest_title = $("#contest_title").val();
    contest_starttime = $("#contest_starttime").val();
    contest_endtime = $("#contest_endtime").val();
    contest_type = $("input[name='contest_type']:checked").val();
    contest_register = $("input[name='contest_canregister']:checked").val();
    contest_number = $('#contest_number').val();
    contest_holder = $('#contest_holder').val();
    contest_intro = $('#contest_intro').val();
    contest_target = $('#contest_target').val();
    contest_plan = $('#contest_plan').val();
    contest_rule = $('#contest_rule').val();
    contest_reward = $('#contest_reward').val();
    contest_registration = $('#contest_registration').val();
    /*console.log(contest_register);
    console.log(contest_type);*/
    //非空判断

    if(contest_starttime === "" || contest_starttime == null){
        layer.msg("开始时间不能为空！");
    }
    else if(contest_endtime === "" || contest_endtime == null){
        layer.msg("结束时间不能为空！");
    }
    else if(contest_holder === "" || contest_holder == null){
        layer.msg("比赛主办方不能为空！");
    }
    else if(contest_intro === "" || contest_intro == null){
        layer.msg("比赛介绍不能为空！");
    }
    else if(contest_target === "" || contest_target == null){
        layer.msg("比赛对象及形式不能为空！");
    }
    else if(contest_plan === "" || contest_plan == null){
        layer.msg("比赛安排及内容不能为空！");
    }
    else if(contest_rule === "" || contest_rule == null){
        layer.msg("比赛规则不能为空！");
    }
    else if(contest_reward === "" || contest_reward == null){
        layer.msg("比赛奖励不能为空！");
    }
    else if(contest_registration === "" || contest_registration == null){
        layer.msg("比赛报名方式不能为空！");
    }
    else if(competition.image != photo){
        uploadInst.upload();
    }
    else{
        updateContest(competition.competitionId, photo, contest_title, contest_starttime, contest_endtime, contest_number, contest_holder , contest_intro ,contest_target ,contest_plan ,contest_rule ,contest_reward,contest_registration ,contest_type, contest_register);
    }
}

//发送更新赛事基本信息请求
function updateContest(id, photo, contest_title, contest_starttime, contest_endtime, contest_number, contest_holder , contest_intro ,
                       contest_target ,contest_plan ,contest_rule ,contest_reward,contest_registration ,contest_type, contest_register) {
    //console.log(id, photo, contest_title, contest_starttime, contest_endtime, contest_number, contest_holder , contest_intro ,
    //contest_target ,contest_plan ,contest_rule ,contest_reward,contest_registration ,contest_type, contest_register)
    $.ajax({
        url : '../../../competition/updateCompetition',
        type:'post',
        data : {"competitionId":id,
            "competitionTitle" : contest_title,
            "start": contest_starttime,
            "end": contest_endtime,
            "isteam": parseInt(contest_type),
            "canregister":parseInt(contest_register),
            "competitionNumber":contest_number,
            "holder":contest_holder,
            "intro":contest_intro,
            "image":photo,
            "target":contest_target,
            "plan":contest_plan,
            "rule":contest_rule,
            "reward":contest_reward,
            "registration":contest_registration
        },
        scriptCharset : 'utf-8',
        success : function (result) {
            if(result.status == "success"){
                layer.open({
                    type: 1,
                    offset: 'auto',
                    id: 'layerDemo2', //防止重复弹出
                    content: '<div style="padding: 20px 100px;">' + "更新成功！" + '</div>',
                    btn: '关闭',
                    btnAlign: 'c', //按钮居中
                    shade: 0.5, //不显示遮罩
                    title: "HZNUCTF",
                    yes: function () {
                        window.location.reload();
                    }
                });
            }
            else{
                layer.msg(result.message);
            }
        },
        error : function () {
            layer.msg('信息更新失败');
        }
    });
}

//删除比赛
function del_contest(){
    var tr = this.parentNode.parentNode;
    var num = tr.childNodes[0].innerText;
    var competition = contest_list[num-1];
    id = competition.competitionId
    layer.open({
        type: 1,
        offset: 'auto', //具体配置参考：http://www.layui.com/doc/modules/layer.html#offset
        id: 'layerDemo1', //防止重复弹出
        content: '<div style="padding: 20px 50px;">' + "确定删除此场比赛吗？" + '</div>',
        btn: ['确定', '取消'],
        btnAlign: 'c', //按钮居中
        shade: 0.5, //不显示遮罩
        title: "删除比赛",
        btn1 : function () {
            delCompetition(id);
            return false;
        },
        btn2 : function () {
            layer.closeAll();
        }
    });
}

function delCompetition(id){
    $.ajax({
        url : '../../../competition/deleteCompetition',
        type : 'post',
        data : {"competitionId" : id},
        scriptCharset : 'utf-8',
        success : function (result) {
            if(result.status == "success"){
                layer.open({
                    type: 1,
                    offset: 'auto', //具体配置参考：http://www.layui.com/doc/modules/layer.html#offset
                    id: 'layerDemo2', //防止重复弹出
                    content: '<div style="padding: 20px 100px;">' + "删除成功！" + '</div>',
                    btn: '确定',
                    btnAlign: 'c', //按钮居中
                    shade: 0.5, //不显示遮罩
                    title: "HZNUCTF",
                    yes : function () {
                        window.location.reload();
                    }
                });
            }
            else{
                layer.msg(result.message);
            }
        },
        error : function () {
            layer.msg("删除失败！");
        }
    });
}
//发送数据到比赛端

Date.prototype.Format = function(fmt) {
    var o = {
        "M+" : this.getMonth()+1,                 //月份
        "d+" : this.getDate(),                    //日
        "h+" : this.getHours(),                   //小时
        "m+" : this.getMinutes(),                 //分
        "s+" : this.getSeconds(),                 //秒
        "q+" : Math.floor((this.getMonth()+3)/3), //季度
        "S"  : this.getMilliseconds()             //毫秒
    };
    if(/(y+)/.test(fmt))
        fmt=fmt.replace(RegExp.$1, (this.getFullYear()+"").substr(4 - RegExp.$1.length));
    for(var k in o)
        if(new RegExp("("+ k +")").test(fmt))
            fmt = fmt.replace(RegExp.$1, (RegExp.$1.length==1) ? (o[k]) : (("00"+ o[k]).substr((""+ o[k]).length)));
    return fmt;
}