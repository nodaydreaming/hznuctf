<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>CTF平台管理系统--轮播图管理</title>
        <meta name="renderer" content="webkit">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=0">
        <meta name="apple-mobile-web-app-status-bar-style" content="black"> 
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="format-detection" content="telephone=no">
        
        <link rel="stylesheet" href="../../../layui/css/layui.css" media="all">
        <link rel="stylesheet" href="../../../layui/css/global.css" media="all">
        <link rel="stylesheet" href="../../../layui/css/modules/layer/default/layer.css" media="all">

        <script type="text/javascript" src="../js/jquery-3.3.1.js"></script>
        <script type="text/javascript" src="../js/general.js"></script>
        <style>
            .bg-color-menu {
                background-color: #20222A !important;
            }
        </style>

    </head>
    <body>
        <div class="layui-layout layui-layout-admin">
            <!-- 顶部导航栏 -->
            <div class="layui-header header header-demo">
                <div class="layui-main">
                    <a class="" href="../main.html" style="height: 100%; font-size: 20px;color: rgba(255, 255, 255, 0.8); line-height: 57px; font-weight: 500">
                    CTF平台管理系统
                    </a>
                    <div class="layui-form component" lay-filter="LAY-site-header-component"></div>
                    <ul class="layui-nav">
                        <li class="layui-nav-item ">
                        <a href="../../../ctf/home.html">返回前台</a>
                        </li>
                        <li class="layui-nav-item">
                            <a href="javascript:;">
                                <img src="../images/user_default.jpg" class="layui-nav-img">
                                我
                                <span class="layui-nav-more"></span>
                            </a>
                            <dl class="layui-nav-child layui-anim layui-anim-upbit" id="list_cur" style="top: 60px;">
                                <dd style="border: 0px; height: 5px;"></dd>
                                <dd><a onclick="openUpdate()" style="cursor:pointer;">修改信息</a></dd>
                                <dd><a onclick="signOut()" style="cursor:pointer;">退出</a></dd>
                            </dl>
                        </li>
                    </ul>
                </div>
            </div>
            <!-- 左侧垂直导航栏 -->
            <div class="layui-side layui-bg-black">
                <div class="layui-side-scroll bg-color-menu">
                    <ul class="layui-nav layui-nav-tree">
                        <li class="layui-nav-item layui-nav-itemed bg-color-menu">
                            <a href="javascript:;"><i class="layui-icon layui-icon-home" style="font-size:16px;"></i>&nbsp;&nbsp;平台管理</a>
                            <dl class="layui-nav-child">
                                <dd class="layui-this">
                                    <a href="#">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;轮播图管理</a>
                                </dd>
                                <dd class="">
                                    <a href="announcement.html">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;公告管理</a>
                                </dd>
                            </dl>
                        </li>
                        
                        <li class="layui-nav-item bg-color-menu">
                            <a href="javascript:;"><i class="layui-icon layui-icon-flag" style="font-size:16px;"></i>&nbsp;&nbsp;赛事管理</a>
                            <dl class="layui-nav-child">
                                <dd class="">
                                    <a href="../contest/add_contest.html">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;创建赛事</a>
                                </dd>
                                <dd class="">
                                    <a href="../contest/contest_list.html">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;赛事列表</a>
                                </dd>
                                <dd class="">
                                    <a href="../contest/highlight_list.html">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;精彩瞬间</a>
                                </dd>
                            </dl>
                        </li>
                        
                        <li class="layui-nav-item bg-color-menu">
                            <a href="javascript:;"><i class="layui-icon layui-icon-template-1" style="font-size:16px;"></i>&nbsp;&nbsp;题目管理</a>
                            <dl class="layui-nav-child">
                                <dd class="">
                                    <a href="../problem/add_problem.html">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;添加题目</a>
                                </dd>
                                <dd class="">
                                    <a href="../problem/problem_set.html">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;题目列表</a>
                                </dd>
                                <dd class="">
                                    <a href="../problem/problem_type.html">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;题目类型</a>
                                </dd>
                            </dl>
                        </li>
                        
                        <li class="layui-nav-item bg-color-menu">
                            <a href="javascript:;"><i class="layui-icon layui-icon-user" style="font-size:16px;"></i>&nbsp;&nbsp;用户管理</a>
                            <dl class="layui-nav-child">
                                <dd class="">
                                    <a href="../user/add_user.html">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;添加用户</a>
                                </dd>
                                <dd class="">
                                    <a href="../user/user_list.html">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;用户列表</a>
                                </dd>
                            </dl>
                        </li>
                        <li class="layui-nav-item bg-color-menu">
                            <a href="javascript:;"><i class="layui-icon layui-icon-set" style="font-size:16px;"></i>&nbsp;&nbsp;管理员信息</a>
                            <dl class="layui-nav-child">
                                <dd class="">
                                    <a href="../admin/add_admin.html">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;添加管理员</a>
                                </dd>
                                <dd class="">
                                    <a href="../admin/admin_list.html">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;管理员列表</a>
                                </dd>
                            </dl>
                        </li>
                        
                        <!-- <li class="layui-nav-item" style="height: 30px; text-align: center"></li> -->
                    </ul>
                </div>
            </div>
        </div>

        <div class="layui-body" id="LAY_app_body" style="margin: 50px; margin-right: 0px;"> 

            <fieldset class="layui-elem-field layui-field-title" style="margin-top:30px;margin-right: 50px;">
                <legend>轮播图上传</legend>
             </fieldset>

            <div style="margin: 20px 30px">
                <form class="layui-form" action="#" method="post" style="margin-top:20px; margin-right: 50px;" id>
                    <div class="layui-upload">
                      <button type="button" class="layui-btn layui-btn-normal" id="testList">选择轮播图</button>
                      <div class="layui-upload-list">
                        <table class="layui-table">
                          <thead>
                            <tr><th>图片</th>
                            <th>大小</th>
                            <th>状态</th>
                            <th>操作</th>
                          </tr></thead>
                          <tbody id="demoList">
                            <notempty name="list">
                              <volist name="list" id="vo">
                               <!--  <tr>
                                   <th><img src="__ROOT__/Uploads/{$vo.img}" style="width:60px;height:60px"></th>
                                   <th>不计</th>
                                   <th>在线</th>
                                   <th><div class="layui-btn layui-btn-mini layui-btn-danger" onclick="imgDel({$vo['img_id']})">删除</div></th>
                               </tr> -->
                              </volist>
                            </notempty>
                          </tbody>
                        </table>
                      </div>
                      <button type="button" class="layui-btn" id="testListAction">开始上传</button>
                      <input type="hidden" name="sid" value="{$_GET['id']}" />  
                    </div>
                </form>
             </div>

             <fieldset class="layui-elem-field layui-field-title" style="margin-top: 100px; margin-right: 50px;">
                <legend>轮播图列表</legend>
             </fieldset>

            <div style="margin: 20px 30px">
                <form class="layui-form" style=" margin-right: 50px;">
                    <div class="layui-form-item">
                        <table class="layui-table" style="table-layout: fixed">
                            <colgroup>
                                <col width="20%">
                                <col width="20%">
                                <col width="35%">
                                <col width="25%">
                            </colgroup>
                            <thead>
                            <tr>
                                <th style="text-align: center; word-wrap: break-word">是否选中为轮播图</th>
                                <th style="text-align: center; word-wrap: break-word">序号</th>
                                <th style="text-align: center; word-wrap: break-word">图片</th>
                                <th style="text-align: center; word-wrap: break-word">操作</th>
                            </tr>
                            </thead>
                            <tbody class="layui-text" id="carouseltbody">
                            </tbody>
                        </table>
                    </div>

                    <div class="layui-form-item" style="margin-top:30px; ">
                        <div class="layui-input-block">
                            <button type="button" class="layui-btn"  onclick="add_carousels()">立即提交</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <!-- 引入或者加载脚本 -->
        <script src="../../../layui/layui.all.js" charset="utf-8"></script>
        <script src="../../../layui/formSelects.js" charset="utf-8"></script>
        <script type="text/javascript" src="js/carousels_list.js"></script>
        </div>
        <div id="LAY_democodejs">
            <script>
                layui.use('element', function(){
                    var element = layui.element; //导航的hover效果、二级菜单等功能，需要依赖element模块
                    //监听导航点击
                    element.on('nav(demo)', function(elem){
                        //console.log(elem)
                        layer.msg(elem.text());
                    });
                });

                layui.use('upload', function(){
                  var upload = layui.upload;
                  //console.log(upload);
                  //执行实例
                  //多文件列表示例
                  var demoListView = $('#demoList')  //tbody的id
                  ,uploadListIns = upload.render({
                    elem: '#testList'   //选择文件按钮的id
                    ,url: '../../../file/uploadCarousel'
                    ,accept: 'images'
                    ,multiple: true
                    ,auto: false
                    ,bindAction: '#testListAction'     //开始上传按钮的id
                    ,choose: function(obj){  
                      var files = this.files = obj.pushFile(); //将每次选择的文件追加到文件队列
                      //读取本地文件
                      obj.preview(function(index, file, result){
                        //console.log(index); //得到文件索引
                        //console.log(file); //得到文件对象
                        //console.log(result); //得到文件base64编码，比如图片
                        var tr = $(['<tr id="upload-'+ index +'">'
                          ,'<td><img src='+result+' style="width:60px;height:60px"></td>'
                          ,'<td>'+ (file.size/1014).toFixed(1) +'kb</td>'
                          ,'<td>等待上传</td>'
                          ,'<td>'
                            ,'<button class="layui-btn layui-btn-mini layui-btn-danger demo-delete">删除</button>'
                          ,'</td>'
                        ,'</tr>'].join(''));//join() 方法用于把数组中的所有元素转换一个字符串。


                        //删除
                        tr.find('.demo-delete').on('click', function(){
                          delete files[index]; //删除对应的文件
                          tr.remove();
                          uploadListIns.config.elem.next()[0].value = ''; //清空 input file 值，以免删除后出现同名文件不可选
                        });
                       
                        demoListView.append(tr);
                      });
                    }
                    ,done: function(res, index, upload){
                      //res（服务端响应信息）、index（当前文件的索引）、upload（重新上传的方法，一般在文件上传失败后使用）
                    if(res.status == "success"){
                        var tr = demoListView.find('tr#upload-'+ index), tds = tr.children();
                        tds.eq(2).html('<span style="color: #5FB878;">上传成功</span>');
                        tds.eq(3).html(''); //清空操作
                        var str = '<input type="hidden" name="photo[]" value='+res.image+'>';
                    $('#demoList').append(str);
                        return delete this.files[index]; //删除文件队列已经上传成功的文件
                       }
                      this.error(index, upload);
                    }
                    ,error: function(index, upload){
                      var tr = demoListView.find('tr#upload-'+ index)
                      ,tds = tr.children();
                      tds.eq(2).html('<span style="color: #FF5722;">上传失败</span>');
                      tds.eq(3).find('.demo-reload').removeClass('layui-hide'); //显示重传
                    }
                  });
                });
            </script>
        </div>
    </body>
</html>