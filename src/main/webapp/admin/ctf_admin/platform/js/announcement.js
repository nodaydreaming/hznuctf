/*var announcement_list = [{"informationId" : 1,"informationTitle":"第一条公告，测试使用！","adminName":"xdxdd","informationCreatetime":"2017.5.8","informationSummary":"东侧还得的","informationDetail":"这是第一条公告的内容，测试使用数据这是第一条公告的内容，"},
                           {"informationId" : 2,"informationTitle":"第er条公告，测试使用！","adminName":"xdxdd","informationCreatetime":"2017.5.8","informationSummary":"东侧还得的","informationDetail":"这是第er条公告的内容，测试使用数据！"},
                           {"informationId" : 3,"informationTitle":"第san条公告，测试使用！", "adminName":"xdxdd","informationCreatetime":"2017.5.8","informationSummary":"东侧还得的","informationDetail":"这是第san条公告的内容，测试使用数据！"},
                           {"informationId" : 4,"informationTitle":"第er条公告，测试使用！","adminName":"xdxdd","informationCreatetime":"2017.5.8","informationSummary":"东侧还得的","informationDetail":"这是第er条公告的内容，测试使用数据！"},
                           {"informationId" : 5,"informationTitle":"第er条公告，测试使用！","adminName":"xdxdd","informationCreatetime":"2017.5.8","informationSummary":"东侧还得的","informationDetail":"这是第er条公告的内容，测试使用数据！"},
                           {"informationId" : 6,"informationTitle":"第er条公告，测试使用！","adminName":"xdxdd","informationCreatetime":"2017.5.8","informationSummary":"东侧还得的","informationDetail":"这是第er条公告的内容，测试使用数据！"},
                           {"informationId" : 7,"informationTitle":"第er条公告，测试使用！","adminName":"xdxdd","informationCreatetime":"2017.5.8","informationSummary":"东侧还得的","informationDetail":"这是第er条公告的内容，测试使用数据！"},
                           {"informationId" : 8,"informationTitle":"第er条公告，测试使用！","adminName":"xdxdd","informationCreatetime":"2017.5.8","informationSummary":"东侧还得的","informationDetail":"这是第er条公告的内容，测试使用数据！"},
                           {"informationId" : 9,"informationTitle":"第er条公告，测试使用！","adminName":"xdxdd","informationCreatetime":"2017.5.8","informationSummary":"东侧还得的","informationDetail":"这是第er条公告的内容，测试使用数据！"},
                           {"informationId" : 10,"informationTitle":"第er条公告，测试使用！","adminName":"xdxdd","informationCreatetime":"2017.5.8","informationSummary":"东侧还得的","informationDetail":"这是第er条公告的内容，测试使用数据！"},
                           {"informationId" : 11,"informationTitle":"第er条公告，测试使用！","adminName":"xdxdd","informationCreatetime":"2017.5.8","informationSummary":"东侧还得的","informationDetail":"这是第er条公告的内容，测试使用数据！"},
                           {"informationId" : 12,"informationTitle":"第er条公告，测试使用！","adminName":"xdxdd","informationCreatetime":"2017.5.8","informationSummary":"东侧还得的","informationDetail":"这是第er条公告的内容，测试使用数据！"},
                           {"informationId" : 13,"informationTitle":"第er条公告，测试使用！","adminName":"xdxdd","informationCreatetime":"2017.5.8","informationSummary":"东侧还得的","informationDetail":"这是第er条公告的内容，测试使用数据！"},
                           {"informationId" : 14,"informationTitle":"第er条公告，测试使用！","adminName":"xdxdd","informationCreatetime":"2017.5.8","informationSummary":"东侧还得的","informationDetail":"这是第er条公告的内容，测试使用数据！"},
                           {"informationId" : 15,"informationTitle":"第er条公告，测试使用！","adminName":"xdxdd","informationCreatetime":"2017.5.8","informationSummary":"东侧还得的","informationDetail":"这是第er条公告的内容，测试使用数据！"},
                           {"informationId" : 16,"informationTitle":"第er条公告，测试使用！","adminName":"xdxdd","informationCreatetime":"2017.5.8","informationSummary":"东侧还得的","informationDetail":"这是第er条公告的内容，测试使用数据！"},
                           {"informationId" : 17,"informationTitle":"第er条公告，测试使用！","adminName":"xdxdd","informationCreatetime":"2017.5.8","informationSummary":"东侧还得的","informationDetail":"这是第er条公告的内容，测试使用数据！"},
                           {"informationId" : 18,"informationTitle":"第er条公告，测试使用！","adminName":"xdxdd","informationCreatetime":"2017.5.8","informationSummary":"东侧还得的","informationDetail":"这是第er条公告的内容，测试使用数据！"},
                           {"informationId" : 19,"informationTitle":"第er条公告，测试使用！","adminName":"xdxdd","informationCreatetime":"2017.5.8","informationSummary":"东侧还得的","informationDetail":"这是第er条公告的内容，测试使用数据！"},
                           {"informationId" : 20,"informationTitle":"第er条公告，测试使用！","adminName":"xdxdd","informationCreatetime":"2017.5.8","informationSummary":"东侧还得的","informationDetail":"这是第er条公告的内容，测试使用数据！"},
                           {"informationId" : 21,"informationTitle":"第er条公告，测试使用！","adminName":"xdxdd","informationCreatetime":"2017.5.8","informationSummary":"东侧还得的","informationDetail":"这是第er条公告的内容，测试使用数据！"},
                           {"informationId" : 22,"informationTitle":"第er条公告，测试使用！","adminName":"xdxdd","informationCreatetime":"2017.5.8","informationSummary":"东侧还得的","informationDetail":"这是第er条公告的内容，测试使用数据！"},
                           {"informationId" : 23,"informationTitle":"第er条公告，测试使用！","adminName":"xdxdd","informationCreatetime":"2017.5.8","informationSummary":"东侧还得的","informationDetail":"这是第er条公告的内容，测试使用数据！"},
                           {"informationId" : 24,"informationTitle":"第er条公告，测试使用！","adminName":"xdxdd","informationCreatetime":"2017.5.8","informationSummary":"东侧还得的","informationDetail":"这是第er条公告的内容，测试使用数据！"},
                           {"informationId" : 25,"informationTitle":"第er条公告，测试使用！","adminName":"xdxdd","informationCreatetime":"2017.5.8","informationSummary":"东侧还得的","informationDetail":"这是第er条公告的内容，测试使用数据！"},
                           {"informationId" : 26,"informationTitle":"第er条公告，测试使用！","adminName":"xdxdd","informationCreatetime":"2017.5.8","informationSummary":"东侧还得的","informationDetail":"这是第er条公告的内容，测试使用数据！"},
                           {"informationId" : 27,"informationTitle":"第er条公告，测试使用！","adminName":"xdxdd","informationCreatetime":"2017.5.8","informationSummary":"东侧还得的","informationDetail":"这是第er条公告的内容，测试使用数据！"},
                           {"informationId" : 28,"informationTitle":"第er条公告，测试使用！","adminName":"xdxdd","informationCreatetime":"2017.5.8","informationSummary":"东侧还得的","informationDetail":"这是第er条公告的内容，测试使用数据！"},
                           {"informationId" : 29,"informationTitle":"第er条公告，测试使用！","adminName":"xdxdd","informationCreatetime":"2017.5.8","informationSummary":"东侧还得的","informationDetail":"这是第er条公告的内容，测试使用数据！"},
                           {"informationId" : 30,"informationTitle":"第er条公告，测试使用！","adminName":"xdxdd","informationCreatetime":"2017.5.8","informationSummary":"东侧还得的","informationDetail":"这是第er条公告的内容，测试使用数据！"},
                           {"informationId" : 31,"informationTitle":"第er条公告，测试使用！","adminName":"xdxdd","informationCreatetime":"2017.5.8","informationSummary":"东侧还得的","informationDetail":"这是第er条公告的内容，测试使用数据！"},
                           {"informationId" : 32,"informationTitle":"第er条公告，测试使用！","adminName":"xdxdd","informationCreatetime":"2017.5.8","informationSummary":"东侧还得的","informationDetail":"这是第er条公告的内容，测试使用数据！"},
                           {"informationId" : 33,"informationTitle":"第er条公告，测试使用！","adminName":"xdxdd","informationCreatetime":"2017.5.8","informationSummary":"东侧还得的","informationDetail":"这是第er条公告的内容，测试使用数据！"},
                           {"informationId" : 34,"informationTitle":"第er条公告，测试使用！","adminName":"xdxdd","informationCreatetime":"2017.5.8","informationSummary":"东侧还得的","informationDetail":"这是第er条公告的内容，测试使用数据！"},
                           {"informationId" : 35,"informationTitle":"第er条公告，测试使用！","adminName":"xdxdd","informationCreatetime":"2017.5.8","informationSummary":"东侧还得的","informationDetail":"这是第er条公告的内容，测试使用数据！"},
                           {"informationId" : 36,"informationTitle":"第er条公告，测试使用！","adminName":"xdxdd","informationCreatetime":"2017.5.8","informationSummary":"东侧还得的","informationDetail":"这是第er条公告的内容，测试使用数据！"},
                           {"informationId" : 37,"informationTitle":"第er条公告，测试使用！","adminName":"xdxdd","informationCreatetime":"2017.5.8","informationSummary":"东侧还得的","informationDetail":"这是第er条公告的内容，测试使用数据！"},
                           {"informationId" : 38,"informationTitle":"第er条公告，测试使用！","adminName":"xdxdd","informationCreatetime":"2017.5.8","informationSummary":"东侧还得的","informationDetail":"这是第er条公告的内容，测试使用数据！"},
                           {"informationId" : 39,"informationTitle":"第er条公告，测试使用！","adminName":"xdxdd","informationCreatetime":"2017.5.8","informationSummary":"东侧还得的","informationDetail":"这是第er条公告的内容，测试使用数据！"},
                           {"informationId" : 40,"informationTitle":"第er条公告，测试使用！","adminName":"xdxdd","informationCreatetime":"2017.5.8","informationSummary":"东侧还得的","informationDetail":"这是第er条公告的内容，测试使用数据！"},
];*/
var announcement_list;
var announcement_title, announcement_content, announcement_summary
window.onload = function () {
    // 此ajax不适用于main.html页面获取管理员信息
    $.ajax({
        url: '../../../admin/getAdminMap',//获取管理员个人信息
        type: 'post',
        scriptCharset: 'utf-8',
        success: function (result) {
            // console.log(result);
            var loginAdmin = result.loginAdmin;
            //设置登陆用户的昵称
            if (loginAdmin.adminNickname != null) {
                ($('.layui-nav-img')[0].parentNode).childNodes[2].data = loginAdmin.adminNickname;
            }
            //设置登陆用户的头像
            if (loginAdmin.adminImage != null) {
                $('.layui-nav-img').attr("src", loginAdmin.adminImage);
            }
        },
        error: function () {
            layer.msg("请求失败！");
        }
    });
    //fillAnnouncement();//测试完毕改成getAnnouncements()！！！！！
    getAnnouncements();
};

function getAnnouncements() {
    $.ajax({
        url : '../../../notice/listNotice', //得到所有公告列表
        type : 'post',
        scriptCharset : 'utf-8',
        success : function (result) {
            if(result.status == "success"){
                announcement_list =result.noticeList;
                fillAnnouncement();
            }
            else{
               layer.msg(result.message);
           }
        },
        error : function () {
            layer.msg("请求公告列表失败！");
        }
    });
}

function fillAnnouncement() {
    if(announcement_list.length < 15){
        var tbody = document.getElementsByTagName('tbody')[0];
        $('tbody').html("");

        for (var i = 0; i < announcement_list.length; ++i){
            var announcement = announcement_list[i];
            //console.log(announcement);
            var tr = document.createElement('tr');

            var td1 = document.createElement('td');
            td1.style.textAlign = "center";
            td1.innerText = i + 1;
            tr.appendChild(td1);

            var td2 = document.createElement('td');
            td2.innerText = announcement.informationTitle;
            td2.style.wordWrap = "break-word";
            tr.appendChild(td2);

            var td3 = document.createElement('td');
            td3.style.textAlign = "center";
            td3.innerText = announcement.adminName;
            td3.style.wordWrap = "break-word";
            tr.appendChild(td3);

            var td4 = document.createElement('td');
            td4.style.textAlign = "center";
            td4.innerText = announcement.informationCreateTime;
            td4.style.wordWrap = "break-word";
            tr.appendChild(td4);

            var td5 = document.createElement('td');
            td5.innerText = announcement.informationSummary;
            td5.style.wordWrap = "break-word";
            tr.appendChild(td5);

            var td6 = document.createElement('td');
            td6.innerText = announcement.informationDetail;
            td6.title = announcement.informationDetail;
            td6.style.maxWidth = "30%";
            td6.style.whiteSpace = "nowrap";
            td6.style.textOverflow = "ellipsis";
            td6.style.overflow = "hidden";
            tr.appendChild(td6);

            var td7 = document.createElement('td');
            td7.style.textAlign = "center";
            td7.style.padding = "0px";

            var a1 = document.createElement('a');
            a1.id = "editPaper" + (i+1);
            a1.className = "layui-btn layui-btn-normal layui-btn-xs";
            var i1 = document.createElement('i');
            i1.className = "layui-icon layui-icon-edit";
            a1.appendChild(i1);
            a1.innerHTML = a1.innerHTML + "编辑";
            a1.onclick = editAnnouncement;

            var a2 = document.createElement('a');
            a2.id = "delPaper" + (i+1);
            a2.className = "layui-btn layui-btn-danger layui-btn-xs";
            var i2 = document.createElement('i');
            i2.className = "layui-icon layui-icon-delete";
            a2.appendChild(i2);
            a2.innerHTML = a2.innerHTML + "删除";
            a2.onclick = delAnnouncement;

            td7.appendChild(a1);
            td7.appendChild(a2);

            tr.appendChild(td7);
            tbody.appendChild(tr);
        }
    }
    else if(announcement_list.length >= 15){
        var tbody = document.getElementsByTagName('tbody')[0];
        $('tbody').html("");

        for (var j = 0; j < 15; ++j){

            var announcement = announcement_list[j];
            //console.log(announcement);
            var tr = document.createElement('tr');

            var td1 = document.createElement('td');
            td1.style.textAlign = "center";
            td1.innerText = j + 1;
            tr.appendChild(td1);

            var td2 = document.createElement('td');
            td2.innerText = announcement.informationTitle;
            td2.style.wordWrap = "break-word";
            tr.appendChild(td2);

            var td3 = document.createElement('td');
            td3.style.textAlign = "center";
            td3.innerText = announcement.adminName;
            td3.style.wordWrap = "break-word";
            tr.appendChild(td3);

            var td4 = document.createElement('td');
            td4.style.textAlign = "center";
            td4.innerText = announcement.informationCreateTime;
            td4.style.wordWrap = "break-word";
            tr.appendChild(td4);

            var td5 = document.createElement('td');
            td5.innerText = announcement.informationSummary;
            td5.style.wordWrap = "break-word";
            tr.appendChild(td5);

            var td6 = document.createElement('td');
            td6.innerText = announcement.informationDetail;
            td6.title = announcement.informationDetail;
            td6.style.maxWidth = "30%";
            td6.style.whiteSpace = "nowrap";
            td6.style.textOverflow = "ellipsis";
            td6.style.overflow = "hidden";
            tr.appendChild(td6);

            var td7 = document.createElement('td');
            td7.style.textAlign = "center";
            td7.style.padding = "0px";

            var a1 = document.createElement('a');
            a1.id = "editPaper" + (i+1);
            a1.className = "layui-btn layui-btn-normal layui-btn-xs";
            var i1 = document.createElement('i');
            i1.className = "layui-icon layui-icon-edit";
            a1.appendChild(i1);
            a1.innerHTML = a1.innerHTML + "编辑";
            a1.onclick = editAnnouncement;

            var a2 = document.createElement('a');
            a2.id = "delPaper" + (i+1);
            a2.className = "layui-btn layui-btn-danger layui-btn-xs";
            var i2 = document.createElement('i');
            i2.className = "layui-icon layui-icon-delete";
            a2.appendChild(i2);
            a2.innerHTML = a2.innerHTML + "删除";
            a2.onclick = delAnnouncement;

            td7.appendChild(a1);
            td7.appendChild(a2);

            tr.appendChild(td7);
            tbody.appendChild(tr);
        }
        $("#paging").sPage({
            page:1,//当前页码，必填
            total:announcement_list.length,//数据总条数，必填
            pageSize:15,//每页显示多少条数据，默认10条
            totalTxt:'共'+announcement_list.length+'条',//数据总条数文字描述，{total}为占位符，默认"共{total}条"
            showTotal:false,//是否显示总条数，默认关闭：false
            showSkip:true,//是否显示跳页，默认关闭：false
            showPN:true,//是否显示上下翻页，默认开启：true
            prevPage:"上一页",//上翻页文字描述，默认“上一页”
            nextPage:"下一页",//下翻页文字描述，默认“下一页”
            backFun:function(page){
                $('tbody').html("");
                var lastpage = parseInt(announcement_list.length/15)+1;
                if(page<lastpage){
                    for (var k = (page-1)*15; k < page*15; k++){

                        var announcement = announcement_list[k];
                        //console.log(announcement);
                        var tr = document.createElement('tr');

                        var td1 = document.createElement('td');
                        td1.style.textAlign = "center";
                        td1.innerText = k + 1;
                        tr.appendChild(td1);

                        var td2 = document.createElement('td');
                        td2.innerText = announcement.informationTitle;
                        td2.style.wordWrap = "break-word";
                        tr.appendChild(td2);

                        var td3 = document.createElement('td');
                        td3.style.textAlign = "center";
                        td3.innerText = announcement.adminName;
                        td3.style.wordWrap = "break-word";
                        tr.appendChild(td3);

                        var td4 = document.createElement('td');
                        td4.style.textAlign = "center";
                        td4.innerText = announcement.informationCreateTime;
                        td4.style.wordWrap = "break-word";
                        tr.appendChild(td4);

                        var td5 = document.createElement('td');
                        td5.innerText = announcement.informationSummary;
                        td5.style.wordWrap = "break-word";
                        tr.appendChild(td5);

                        var td6 = document.createElement('td');
                        td6.innerText = announcement.informationDetail;
                        td6.title = announcement.informationDetail;
                        td6.style.maxWidth = "30%";
                        td6.style.whiteSpace = "nowrap";
                        td6.style.textOverflow = "ellipsis";
                        td6.style.overflow = "hidden";
                        tr.appendChild(td6);

                        var td7 = document.createElement('td');
                        td7.style.textAlign = "center";
                        td7.style.padding = "0px";

                        var a1 = document.createElement('a');
                        a1.id = "editPaper" + (i+1);
                        a1.className = "layui-btn layui-btn-normal layui-btn-xs";
                        var i1 = document.createElement('i');
                        i1.className = "layui-icon layui-icon-edit";
                        a1.appendChild(i1);
                        a1.innerHTML = a1.innerHTML + "编辑";
                        a1.onclick = editAnnouncement;

                        var a2 = document.createElement('a');
                        a2.id = "delPaper" + (i+1);
                        a2.className = "layui-btn layui-btn-danger layui-btn-xs";
                        var i2 = document.createElement('i');
                        i2.className = "layui-icon layui-icon-delete";
                        a2.appendChild(i2);
                        a2.innerHTML = a2.innerHTML + "删除";
                        a2.onclick = delAnnouncement;

                        td7.appendChild(a1);
                        td7.appendChild(a2);

                        tr.appendChild(td7);
                        tbody.appendChild(tr);
                    }
                }
                else if(page == lastpage){
                    for (var k = (page-1)*15; k < announcement_list.length; k++){
                    
                        var announcement = announcement_list[k];
                        //console.log(announcement);
                        var tr = document.createElement('tr');

                        var td1 = document.createElement('td');
                        td1.style.textAlign = "center";
                        td1.innerText = k + 1;
                        tr.appendChild(td1);

                        var td2 = document.createElement('td');
                        td2.innerText = announcement.informationTitle;
                        td2.style.wordWrap = "break-word";
                        tr.appendChild(td2);

                        var td3 = document.createElement('td');
                        td3.style.textAlign = "center";
                        td3.innerText = announcement.adminName;
                        td3.style.wordWrap = "break-word";
                        tr.appendChild(td3);

                        var td4 = document.createElement('td');
                        td4.style.textAlign = "center";
                        td4.innerText = announcement.informationCreateTime;
                        td4.style.wordWrap = "break-word";
                        tr.appendChild(td4);

                        var td5 = document.createElement('td');
                        td5.innerText = announcement.informationSummary;
                        td5.style.wordWrap = "break-word";
                        tr.appendChild(td5);

                        var td6 = document.createElement('td');
                        td6.innerText = announcement.informationDetail;
                        td6.title = announcement.informationDetail;
                        td6.style.maxWidth = "30%";
                        td6.style.whiteSpace = "nowrap";
                        td6.style.textOverflow = "ellipsis";
                        td6.style.overflow = "hidden";
                        tr.appendChild(td6);

                        var td7 = document.createElement('td');
                        td7.style.textAlign = "center";
                        td7.style.padding = "0px";

                        var a1 = document.createElement('a');
                        a1.id = "editPaper" + (i+1);
                        a1.className = "layui-btn layui-btn-normal layui-btn-xs";
                        var i1 = document.createElement('i');
                        i1.className = "layui-icon layui-icon-edit";
                        a1.appendChild(i1);
                        a1.innerHTML = a1.innerHTML + "编辑";
                        a1.onclick = editAnnouncement;

                        var a2 = document.createElement('a');
                        a2.id = "delPaper" + (i+1);
                        a2.className = "layui-btn layui-btn-danger layui-btn-xs";
                        var i2 = document.createElement('i');
                        i2.className = "layui-icon layui-icon-delete";
                        a2.appendChild(i2);
                        a2.innerHTML = a2.innerHTML + "删除";
                        a2.onclick = delAnnouncement;

                        td7.appendChild(a1);
                        td7.appendChild(a2);

                        tr.appendChild(td7);
                        tbody.appendChild(tr);
                    }
                }
            }
        });
    }
}

function open_add_announcement() {
    layer.open({
        type: 1,
        offset: 'auto',
        skin: 'layui-layer-lan',
        id: 'layerDemo1', //防止重复弹出
        area: ['600px', '400px'],
        content:
        '<form class="layui-form" action="" style="margin:50px 0 0 5%; font-size:15px">\n' +
                //公告标题
            '    <div class="layui-form-item">\n' +
            '        <label class="layui-form-label">公告标题</label>\n' +
            '        <div class="layui-input-block">\n' +
            '            <input type="text" id="announcement_title" autocomplete="off" placeholder="请输入公告标题" required class="layui-input" style="width: 80%;" onchange="inputLimit()" onkeydown="inputLimit()" onkeyup="inputLimit()">\n' +
            '        </div>\n' +   
            '    </div>\n' +
                 //公告摘要
            '    <div class="layui-form-item">\n' +
            '        <label class="layui-form-label">公告摘要</label>\n' +
            '        <div class="layui-input-block">\n' +
            '           <textarea class="add_summary layui-textarea" placeholder="请输入公告摘要"\n' +
            '                     style="width: 80%; height: 50px; resize:none"\n' +
            '                     onchange="textarea_fun()" onkeydown="textarea_fun()" onkeyup="textarea_fun()"></textarea>\n' +
            '        </div>\n' +
            '    </div>\n' +
                 //公告内容
            '    <div class="layui-form-item">\n' +
            '        <label class="layui-form-label">公告内容</label>\n' +
            '        <div class="layui-input-block">\n' +
            '           <textarea class="tcp_content layui-textarea" placeholder="请输入公告内容"\n' +
            '                     style="width: 80%; height: 130px; resize:none"\n' +
            '                     onchange="textarea_fun()" onkeydown="textarea_fun()" onkeyup="textarea_fun()"></textarea>\n' +
            '        </div>\n' +
            '    </div>\n' +
            '</form>\n' +
            '<script>\n' +
            'layui.use(\'form\', function(){\n' +
            '  var form = layui.form;\n' +
            '  form.render();\n' +
            '});' +
            '</script>',
        btn: ['确定', '取消'],
        btnAlign: 'c',
        shade: 0.5,
        title: "添加公告",
        btn1 : function () {
            add_announcement();
            return false;
        },
        btn2 : function () {
            layer.closeAll();
        }
    });
}

function add_announcement() {
    announcement_title = $('#announcement_title').val();
    announcement_summary = $('.add_summary').val();
    announcement_content = $('.tcp_content').val();

    if(announcement_title == null || announcement_title == ""){
        layer.tips("标题不能为空！", "#announcement_title");
    }
    else if (announcement_summary == null || announcement_summary == ""){
        layer.tips("摘要不能为空！", ".add_summary");
    }
    else if(announcement_content == null || announcement_content == ""){
        layer.tips("内容不能为空！", ".tcp_content");
    }
    else{
        add_Announcement(announcement_title,announcement_summary,announcement_content);
    }
}

function add_Announcement(title, summary,content) {
    $.ajax({
        url : '../../../information/insert',  //新发布公告
        type : 'post',
        data : {
            "informationTitle" : title,
            "informationSummary" : summary,
            "informationDetail" : content
        },
        scriptCharset : 'utf-8',
        success : function (result) {
            if(result.status == "success") {
                layer.open({
                    type: 1,
                    offset: 'auto', //具体配置参考：http://www.layui.com/doc/modules/layer.html#offset
                    id: 'layerDemo2', //防止重复弹出
                    content: '<div style="padding: 20px 100px;">' + "添加成功！" + '</div>',
                    btn: '关闭',
                    btnAlign: 'c', //按钮居中
                    shade: 0.5, //不显示遮罩
                    title: "添加公告",
                    yes: function () {
                        layer.closeAll();
                    }
                });
                getAnnouncements();
            }
            else{
                layer.msg(result.message);
            }
        },
        error : function () {
            layer.msg('请求添加失败！');
        }
    });
}

function editAnnouncement() {
    var tr = this.parentNode.parentNode;
    var num = tr.childNodes[0].innerText;
    var announcement = announcement_list[num-1];
    //console.log(announcement);
    layer.open({
        type: 1,
        offset: 'auto',
        skin: 'layui-layer-lan',
        id: 'layerDemo1', //防止重复弹出
        area: ['600px', '400px'],
        content:
        '<form class="layui-form" action="" style="margin:50px 0 0 5%; font-size:15px">\n' +
             //公告标题
        '    <div class="layui-form-item">\n' +
        '        <label class="layui-form-label">公告标题</label>\n' +
        '        <div class="layui-input-block">\n' +
        '            <input type="text" id="announcement_title"  placeholder="请输入公告标题" required class="edit_title layui-input" value="'+ announcement.informationTitle +'"style="width: 80%;" onchange="inputLimit()" onkeydown="inputLimit()" onkeyup="inputLimit()">\n' +
        '        </div>\n' +   
        '    </div>\n' +
             //公告摘要
        '    <div class="layui-form-item">\n' +
        '        <label class="layui-form-label">公告摘要</label>\n' +
        '        <div class="layui-input-block">\n' +
        '           <textarea class="edit_summary layui-textarea" placeholder="请输入公告摘要"\n' +
        '                     style="width: 80%; height: 50px; resize:none"\n' +
        '                     onchange="textarea_fun()" onkeydown="textarea_fun()" onkeyup="textarea_fun()">'+ announcement.informationSummary +'</textarea>\n' +
        '        </div>\n' +
        '    </div>\n' +
             //公告内容
        '    <div class="layui-form-item">\n' +
        '        <label class="layui-form-label">公告内容</label>\n' +
        '        <div class="layui-input-block">\n' +
        '           <textarea class="tcp_content layui-textarea" placeholder="请输入公告内容"\n' +
        '                     style="width: 80%; height: 130px; resize:none"\n' +
        '                     onchange="textarea_fun()" onkeydown="textarea_fun()" onkeyup="textarea_fun()">'+ announcement.informationDetail +'</textarea>\n' +
        '        </div>\n' +
        '    </div>\n' +
       
        '</form>\n' +
        '<script>\n' +
        'layui.use(\'form\', function(){\n' +
        '  var form = layui.form;\n' +
        '  form.render();\n' +
        '});' +
        '</script>',
        btn: ['确定', '取消'],
        btnAlign: 'c',
        shade: 0.5,
        title: "更新公告信息",
        btn1 : function () {
            edit_announcement(announcement);
            return false;
        },
        btn2 : function () {
            layer.closeAll();
        }
    });
}

function edit_announcement(announcement) {
   
    announcement_title = $('.edit_title').val();
    announcement_summary = $('.edit_summary').val();
    announcement_content = $('.tcp_content').val();

    if(announcement_title == null || announcement_title == ""){
        layer.tips("标题不能为空！", ".edit_title");
    }
    else if(announcement_summary == null || announcement_summary == ""){
        layer.tips("摘要不能为空！", ".edit_summary");
    }
    else if(announcement_content == null || announcement_content == ""){
        layer.tips("内容不能为空！", ".tcp_content");
    }
    else{
        updateAnnouncement(announcement.informationId, announcement_title,announcement_summary,announcement_content);
    }

}

function updateAnnouncement(id,title, summary,content) {
    $.ajax({
        url : '../../../information/updateInformation',  //编辑公告
        type : 'post',
        data : {
            "informationId" : id,
            "informationTitle" : title,
            "informationSummary" : summary,
            "informationDetail" : content
        },
        scriptCharset : 'utf-8',
        success : function (result) {
            if(result.status == "success") {
                layer.open({
                    type: 1,
                    offset: 'auto', //具体配置参考：http://www.layui.com/doc/modules/layer.html#offset
                    id: 'layerDemo2', //防止重复弹出
                    content: '<div style="padding: 20px 100px;">' + "更新成功！" + '</div>',
                    btn: '关闭',
                    btnAlign: 'c', //按钮居中
                    shade: 0.5, //不显示遮罩
                    title: "HZNUCTF",
                    yes: function () {
                        layer.closeAll();
                    }
                });
                getAnnouncements();
            }
            else{
                layer.msg(result.message);
            }
        },
        error : function () {
            layer.msg('请求更新失败！');
        }
    });
}

function delAnnouncement() {
    var tr = this.parentNode.parentNode;
    var num = tr.childNodes[0].innerText;
    var announcement = announcement_list[num-1];
    layer.open({
        type: 1,
        offset: 'auto', //具体配置参考：http://www.layui.com/doc/modules/layer.html#offset
        id: 'layerDemo1', //防止重复弹出
        content: '<div style="padding: 20px 50px;">' + "确定删除此条公告吗？" + '</div>',
        btn: ['确定', '取消'],
        btnAlign: 'c', //按钮居中
        shade: 0.5, //不显示遮罩
        title: "删除公告",
        btn1 : function () {
            delannouncement(announcement);
            return false;
        },
        btn2 : function () {
            layer.closeAll();
        }
    });
}

function delannouncement(announcement) {
    var id = announcement.informationId;
    //console.log(id);
    $.ajax({
        url : '../../../information/deleteInformation', //删除公告
        type : 'post',
        data : {"informationId" : id},
        scriptCharset : 'utf-8',
        success : function (result) {
            if(result.status == "success"){
                layer.open({
                    type: 1,
                    offset: 'auto', //具体配置参考：http://www.layui.com/doc/modules/layer.html#offset,
                    id: 'layerDemo2', //防止重复弹出
                    content: '<div style="padding: 20px 100px;">' + "删除成功！" + '</div>',
                    btn: '确定',
                    btnAlign: 'c', //按钮居中
                    shade: 0.5, //不显示遮罩
                    title: "HZNUCTF",
                    yes : function () {
                        layer.closeAll();
                    }
                });
                getAnnouncements();
            }
            else{
                layer.msg(result.message);
            }
        },
        error : function () {
            layer.msg("删除失败！");
        }
    });
}

function textarea_fun(){
    $(".tcp_content").val($(".tcp_content").val().substring(0,500));
    $(".t_h i").html($(".tcp_content").val().length);
    if(window.event.keyCode  == 13){
        return false;
    }
}

Date.prototype.Format = function(fmt)
{
    var o = {
        "M+" : this.getMonth()+1,                 //月份
        "d+" : this.getDate(),                    //日
        "h+" : this.getHours(),                   //小时
        "m+" : this.getMinutes(),                 //分
        "s+" : this.getSeconds(),                 //秒
        "q+" : Math.floor((this.getMonth()+3)/3), //季度
        "S"  : this.getMilliseconds()             //毫秒
    };
    if(/(y+)/.test(fmt))
        fmt=fmt.replace(RegExp.$1, (this.getFullYear()+"").substr(4 - RegExp.$1.length));
    for(var k in o)
        if(new RegExp("("+ k +")").test(fmt))
            fmt = fmt.replace(RegExp.$1, (RegExp.$1.length==1) ? (o[k]) : (("00"+ o[k]).substr((""+ o[k]).length)));
    return fmt;
}